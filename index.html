<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Simulateur D√©cisionnel : Classe Flexible</title>
<style>
body { font-family: Arial, sans-serif; background: #f7f9fa; color: #222; margin:0; padding:20px; font-size: 16px;}
.container { max-width: 900px; margin: auto; }
h1, h2 { color: #266698; }
.letter-box { display: inline-block; width:40px; height:40px; background:#e3eaf4; margin:5px; text-align:center; line-height:40px; border-radius:8px; font-weight:bold; font-size:1.3em; border:1px solid #abbfd3;}
.letter-box.unlocked { background:#acd0e0; color:#222;}
.letter-box.hidden { background:#ccc; color:transparent;}
.qcm label { display: block; margin: 10px 0; cursor: pointer; padding: 8px; border-radius: 6px;}
.qcm label:hover { background: #f0f4f8;}
button { background:#266698; color:#fff; border:none; border-radius:6px; padding:12px 18px; margin:10px 5px 10px 0; cursor:pointer; font-size: 1em;}
button:disabled { background:#bbb; cursor: not-allowed;}
button:hover:not(:disabled) { background:#1e5178;}
.back-btn { background: #6c757d;}
.reset-btn { background: #dc3545; }
img { max-width: 100%; max-height: 300px; object-fit: cover; border-radius: 8px; margin:10px 0;}
.dragspace { background:#ececec; padding:15px; border-radius:8px; min-height:70px; display:flex; gap:10px; flex-wrap:wrap; margin:10px 0; border:2px dashed #266698;}
.draggable { background:#547db2; margin: 4px; padding: 10px; font-size: 0.9em; cursor: move; color: white; border-radius: 4px;}
.resources { background: #e8f4f8; padding: 20px; border-radius: 8px; margin: 20px 0; border-left: 4px solid #266698;}
.resources a { color: #1e5178; text-decoration: none; font-weight: 500; display: block; margin: 12px 0; padding: 12px; background: white; border-radius: 6px;}
.keyword-input { background: white; padding: 20px; border-radius: 8px; margin: 20px 0; border: 2px solid #266698;}
.keyword-input input { width: 100%; padding: 10px; border: 2px solid #abbfd3; border-radius: 6px; font-size: 1em; margin: 10px 0; box-sizing: border-box;}
.keyword-hint { color: #666; font-style: italic; margin: 5px 0;}
.discussion-box { background: #fff3cd; padding: 20px; border-radius: 8px; margin: 20px 0; border-left: 4px solid #ffc107;}
.success-message { background: #d4edda; color: #155724; padding: 20px; border-radius: 8px; margin: 20px 0; text-align: center;}
.code-display { background: #fff; padding: 15px; border-radius: 8px; margin: 15px 0;}
.code-display .letters { display: flex; justify-content: center; gap: 10px; flex-wrap: wrap;}
.code-display .letter { width: 50px; height: 50px; background: #acd0e0; border-radius: 8px; text-align: center; line-height: 50px; font-size: 1.8em; font-weight: bold; border: 2px solid #266698;}
.steps-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px; margin: 20px 0;}
.qr-container { text-align: center; margin: 30px 0;}
.qr-container img { max-width: 250px; border: 3px solid #266698; border-radius: 12px; padding: 10px; background: white;}
textarea { width: 100%; min-height: 120px; padding: 10px; border: 2px solid #abbfd3; border-radius: 8px; font-size: 1em; box-sizing: border-box;}
</style>
</head>
<body>
<div class="container">
<h1>Simulateur : Classe Flexible</h1>
<div id="progress">Lettres d√©bloqu√©es :</div>
<div id="letters"></div>
<div id="game"></div>
<div style="margin: 20px 0;">
  <h3 style="color:#266698;">üìù Notes</h3>
  <textarea id="notes" placeholder="Vos notes..."></textarea>
  <button onclick="downloadNotes()">üíæ T√©l√©charger</button>
</div>
</div>

<script>
let state = {step: 0, score:0, letters: [], parcours:[]};
const steps = [
  {
    titre:"S ‚Äì Sensibiliser",
    keyword: {q: "Qu'est-ce qu'un am√©nagement de classe flexible peut tendre √† r√©duire chez les √©l√®ves ?", hint: "(2 mots)", answer: "le stress"},
    resources: {title: "üìö Ressource", intro: "Consultez cette ressource :", link: {url:"https://www.reseau-canope.fr/actualites/article/amenager-sa-classe-pour-servir-sa-pedagogie", text:"Am√©nager sa classe (Canop√©)"}},
    texte:"Quel argument est le plus efficace ?",
    qcm: [{text:"¬´ C'est un projet sp√©cifique. ¬ª", correct:false},{text:"¬´ Favorise la collaboration et l'engagement. ¬ª", correct:true},{text:"¬´ C'est le XXIe si√®cle ! ¬ª", correct:false}],
    visuel:"https://cdn.pixabay.com/photo/2017/01/10/19/05/classroom-1963759_960_720.jpg"
  },
  {
    titre:"O ‚Äì Organiser",
    keyword: {q: "Quel outil pour planifier les t√¢ches peut √™tre utile dans les deux degr√©s ?", hint: "(4 mots)", answer: "le plan de travail"},
    resources: {title: "üìö Ressource", intro: "√âtapes d'un projet :", link: {url:"https://bloghoptoys.fr/comment-reussir-votre-projet-de-classe-flexible/", text:"Projet classe flexible (Hop'Toys)"}},
    texte:"Organisez les √©tapes (une carte par √©tape) :",
    dragtask: {
      items: [
         {id:"1", text:"D√©finir les objectifs", cat:"etape1"},
         {id:"2", text:"Former l'√©quipe", cat:"etape2"},
         {id:"3", text:"R√©cup√©rer du mat√©riel", cat:"etape3"},
         {id:"4", text:"Am√©nager la classe", cat:"etape4"},
         {id:"5", text:"√âtablir des r√®gles", cat:"etape5"},
         {id:"6", text:"Observer et ajuster", cat:"etape6"},
         {id:"7", text:"Acheter sans concertation", cat:"piege"},
         {id:"8", text:"Tout changer d'un coup", cat:"piege"}
      ],
      cats: [{name: "√âtape 1", key:"etape1"},{name: "√âtape 2", key:"etape2"},{name: "√âtape 3", key:"etape3"},{name: "√âtape 4", key:"etape4"},{name: "√âtape 5", key:"etape5"},{name: "√âtape 6", key:"etape6"}]
    },
    visuel:"https://images.unsplash.com/photo-1523580846011-d3a5bc25702b"
  },
  {
    titre:"U ‚Äì Utilit√©",
    keyword: {q: "Conseil d'Am√©lie : doit-on tout changer ?", hint: "(oui ou non)", answer: "non"},
    discussion: "üí¨ Discutez des points qui vous ont marqu√©s.",
    resources: {title: "üìö Ressource vid√©o", intro: "B√©n√©fices p√©dagogiques :", link: {url:"https://canotech.fr/a/la-classe-flexible-pour-faire-classe-a-tous-les-eleves", text:"Classe flexible (CanoTech)"}},
    texte:"Avantages document√©s :",
    qcm: [{text:"Motivation des √©l√®ves", correct:true},{text:"Meilleur climat", correct:true},{text:"R√©sultats automatiques", correct:false},{text:"Favorise l'autonomie", correct:true},{text:"Plus de bruit", correct:false}],
    visuel:"https://cdn.pixabay.com/photo/2017/09/09/21/13/class-2732253_960_720.jpg"
  },
  {
    titre:"P ‚Äì Parent inquiet",
    keyword: {q: "Quel sport pour la m√©taphore du travail d'√©quipe (t√©moignage Anne-C√©cile) ?", hint: "(2 mots)", answer: "le curling"},
    resources: {title: "üìö Ressource", intro: "Impliquer les parents :", link: {url:"https://archiclasse.education.fr/Un-projet-accompagne-est-toujours-un-projet-reussi", text:"Projet accompagn√© (Archiclasse)"}},
    texte:"Que montrer en priorit√© ?",
    qcm:[{text:"Photos d'√©l√®ves concentr√©s.", correct:true},{text:"Budget mobilier.", correct:false},{text:"Statistiques nationales.", correct:false}],
    visuel:"https://cdn.pixabay.com/photo/2015/09/18/21/13/classroom-942422_960_720.jpg"
  },
  {
    titre:"L ‚Äì Limiter",
    keyword: {q: "Le professeur laisse ... de l'espace de travail √† l'√©l√®ve BEP.", hint: "(2 mots)", answer: "le choix"},
    resources: {title: "üìö Ressource", intro: "Adapter et g√©rer le bruit :", link: {url:"https://www.classe-de-demain.fr/accueil/classe-flexible/comment-adapter-sa-classe-flexible-aux-eleves-aux-besoins-educatifs-particuliers-bep-episode-4", text:"BEP et bruit (Classe de Demain)"}},
    texte:"Action prioritaire ?",
    qcm:[{text:"Tapis, panneaux acoustiques.", correct:true},{text:"Fermer la salle.", correct:false},{text:"Accuser l'enseignant.", correct:false}],
    visuel:"https://images.unsplash.com/photo-1524995997946-a1c2e315a42f"
  },
  {
    titre:"E ‚Äì √âvoluer",
    keyword: {q: "Planning ... pour r√©partir les assises ?", hint: "(1 mot)", answer: "hebdomadaire"},
    resources: {title: "üìö Ressource", intro: "Posture de l'enseignant :", link: {url:"https://bloghoptoys.fr/comment-gerer-les-differentes-assises-de-la-classe/", text:"Assises (Hop'Toys)"}},
    texte:"Attitudes favorisant la posture de guide :",
    qcm:[{text:"Encourager l'autonomie", correct:true},{text:"Laisser seuls", correct:false},{text:"Varier les modalit√©s", correct:true},{text:"Varier les assises", correct:true},{text:"Sanctionner", correct:false}],
    visuel:"https://cdn.pixabay.com/photo/2018/01/20/08/33/laptop-3095990_960_720.jpg"
  }
];

function norm(t){ return t.toLowerCase().trim().replace(/[^\w\s]/g, '').replace(/\s+/g, ' ');}

function updateLetters(){
  document.getElementById('letters').innerHTML = 'SOUPLE'.split('').map((l,i)=> {
    const u = state.letters.includes(l);
    return `<span class="letter-box ${u?'unlocked':'hidden'}">${u?l:'?'}</span>`;
  }).join('');
}

function showStep(){
  updateLetters();
  const g = document.getElementById('game');
  if(state.step >= steps.length){ showEnd(); return; }
  
  const s = steps[state.step];
  let html = state.step > 0 ? '<button class="back-btn" onclick="goBack()">‚Üê Retour</button>' : '';
  html += `<h2>${s.titre}</h2>`;
  
  // Ressource
  html += `<div class="resources"><h3>${s.resources.title}</h3><p>${s.resources.intro}</p>
    <a href="${s.resources.link.url}" target="_blank">üìö ${s.resources.link.text}</a>
    <button id="readBtn" onclick="showQuestion()">‚úÖ J'ai lu la ressource</button></div>`;
  
  // Zone question (cach√©e)
  html += `<div id="questionZone" style="display:none;">
    <div class="keyword-input">
      <h4>Question de compr√©hension :</h4>
      <p><strong>${s.keyword.q}</strong></p>
      <p class="keyword-hint">${s.keyword.hint}</p>
      <input type="text" id="keyInput" placeholder="Votre r√©ponse...">
      <button onclick="checkKeyword()">Valider</button>
    </div></div>`;
  
  // Zone activit√© (cach√©e)
  html += `<div id="activityZone" style="display:none;">`;
  if(s.discussion) html += `<div class="discussion-box"><h4>üí¨ Temps d'√©change</h4><p>${s.discussion}</p></div>`;
  html += `<h3>${s.texte}</h3>`;
  if(s.visuel) html += `<img src="${s.visuel}" alt="">`;
  
  if(s.qcm){
    html += '<form class="qcm" id="qcmForm">';
    s.qcm.forEach((o,i)=> html += `<label><input type="checkbox" name="q" value="${i}"> ${o.text}</label>`);
    html += '<button type="button" onclick="checkQCM()">Valider</button></form>';
  }
  
  if(s.dragtask){
    html += '<div class="dragspace" id="dragSrc"><strong>√Ä placer :</strong><br></div>';
    html += '<div class="steps-grid" id="dropZones"></div>';
    html += '<button class="reset-btn" onclick="resetDrag()">üîÑ R√©initialiser</button>';
    html += '<button onclick="checkDrag()">Valider</button>';
  }
  html += '</div>';
  
  g.innerHTML = html;
  
  if(s.dragtask) initDrag(s.dragtask);
}

let currentStep;
function showQuestion(){
  document.getElementById('readBtn').style.display='none';
  document.getElementById('questionZone').style.display='block';
  document.getElementById('keyInput').focus();
}

function checkKeyword(){
  const s = steps[state.step];
  const inp = document.getElementById('keyInput').value;
  if(norm(inp) === norm(s.keyword.answer)){
    document.getElementById('questionZone').style.display='none';
    document.getElementById('activityZone').style.display='block';
  } else {
    alert("R√©ponse incorrecte. Relisez la ressource.");
  }
}

function checkQCM(){
  const s = steps[state.step];
  const checks = Array.from(document.querySelectorAll('#qcmForm input'));
  let ok = checks.every((c,i)=> c.checked === s.qcm[i].correct);
  if(ok){
    state.score += s.qcm.filter(q=>q.correct).length;
    document.querySelector('#qcmForm button').disabled=true;
    nextStep();
  } else {
    alert("R√©essayez !");
  }
}

let dragData = {};
function initDrag(task){
  dragData = {items: task.items.slice().sort(()=>Math.random()-0.5), cats: task.cats.map(c=>({...c, item:null}))};
  const src = document.getElementById('dragSrc');
  dragData.items.forEach(it=>{
    const d = document.createElement('span');
    d.className='draggable';
    d.textContent=it.text;
    d.draggable=true;
    d.dataset.id=it.id;
    d.ondragstart= e=> e.dataTransfer.setData('id',it.id);
    src.appendChild(d);
  });
  
  const zones = document.getElementById('dropZones');
  dragData.cats.forEach(cat=>{
    const z = document.createElement('div');
    z.className='dragspace';
    z.innerHTML=`<strong>${cat.name}</strong><br>`;
    z.dataset.cat=cat.key;
    z.ondragover=e=>e.preventDefault();
    z.ondrop=e=>{
      e.preventDefault();
      const id = e.dataTransfer.getData('id');
      const el = document.querySelector(`[data-id="${id}"]`);
      if(el){
        if(cat.item){
          const old = z.querySelector('.draggable');
          if(old) src.appendChild(old);
        }
        dragData.cats.forEach(c=>{ if(c.item && c.item.id===id) c.item=null; });
        z.appendChild(el);
        cat.item = dragData.items.find(i=>i.id==id);
      }
    };
    zones.appendChild(z);
  });
}

function resetDrag(){
  const src = document.getElementById('dragSrc');
  dragData.cats.forEach(c=>{
    if(c.item){
      const el = document.querySelector(`[data-id="${c.item.id}"]`);
      if(el) src.appendChild(el);
      c.item=null;
    }
  });
}

function checkDrag(){
  const filled = dragData.cats.filter(c=>c.item).length;
  if(filled!==6){ alert("Placez 6 √©l√©ments !"); return; }
  const hasPiege = dragData.cats.some(c=>c.item && c.item.cat==='piege');
  const ok = dragData.cats.every(c=>c.item && c.item.cat===c.key);
  if(ok && !hasPiege){
    state.score+=2;
    document.querySelectorAll('#activityZone button').forEach(b=>b.disabled=true);
    nextStep();
  } else {
    alert(hasPiege ? "Attention aux pi√®ges !" : "Ordre incorrect !");
  }
}

function nextStep(){
  state.letters.push("SOUPLE"[state.step]);
  state.parcours.push(steps[state.step].titre);
  updateLetters();
  
  const g = document.getElementById('game');
  g.innerHTML = `<div class="success-message"><h3>üéâ Lettre "${state.letters[state.letters.length-1]}" d√©bloqu√©e !</h3>
    <div class="code-display"><p><strong>Code :</strong></p><div class="letters">
    ${state.letters.map(l=>`<span class="letter">${l}</span>`).join('')}</div></div>
    <button onclick="state.step++; showStep()">Continuer ‚Üí</button></div>`;
}

function goBack(){
  if(state.step>0){
    state.step--;
    if(state.letters.length>state.step){ state.letters.pop(); state.parcours.pop(); }
    showStep();
  }
}

function showEnd(){
  updateLetters();
  const perf = state.score>=12 ? "Exemplaire !" : state.score>=9 ? "Solide" : "√Ä am√©liorer";
  document.getElementById('game').innerHTML = `
    <h2>üéâ Termin√© !</h2>
    <div class="code-display"><p><strong>Code final : SOUPLE</strong></p>
    <div class="letters">${'SOUPLE'.split('').map(l=>`<span class="letter">${l}</span>`).join('')}</div></div>
    <p>Score : ${state.score}/16 - <b>${perf}</b></p>
    <div class="qr-container"><h3>üéÅ D√©couvrez ma r√©compense !</h3>
    <img src="qr.png" alt="QR Code"></div>
    <button onclick="exportData()">üì• Exporter</button>`;
}

function exportData(){
  const txt = `Score: ${state.score}/16\nParcours: ${state.parcours.join(', ')}\nNotes: ${document.getElementById('notes').value}`;
  const blob = new Blob([txt], {type:"text/plain"});
  const a = document.createElement('a');
  a.download='Parcours_CF.txt';
  a.href= URL.createObjectURL(blob);
  a.click();
}

function downloadNotes(){
  const n = document.getElementById('notes').value;
  if(!n.trim()){ alert("Aucune note !"); return; }
  const blob = new Blob([n], {type:"text/plain"});
  const a = document.createElement('a');
  a.download='Notes_CF.txt';
  a.href= URL.createObjectURL(blob);
  a.click();
}

window.onload = ()=> showStep();
</script>
</body>
</html>
